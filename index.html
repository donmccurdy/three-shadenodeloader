<!DOCTYPE html>
<meta charset="utf-8">
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #000;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
</style>
<script src="./node_modules/three/build/three.js"></script>
<script type="module">
  import { ShadeLoader } from './ShadeLoader.js';

  const renderer = new THREE.WebGLRenderer( { antialias: true } );
  renderer.setSize( window.innerWidth, window.innerHeight );
  renderer.physicallyCorrectLights = true;
  renderer.gammaOutput = true;
  renderer.gammaFactor = 2.2;
  document.body.appendChild( renderer.domElement );

  const scene = new THREE.Scene();

  const camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 0.1, 10 );
  camera.position.set( 5, 3, 4 );
  scene.add( camera );

  const hemiLight = new THREE.HemisphereLight( 0x4488AA, 0x22DD77, 1.0 );
  scene.add( hemiLight );

  const directLight = new THREE.PointLight( 0x888888, 1.0 );
  directLight.position.set( 3, 5, 3 );
  scene.add( directLight );

  const clock = new THREE.Clock();

  const loader = new ShadeLoader();

  loader.load(

    'shaders/Dissolve/Graph.json',

    ( material ) => {

      console.info( '[THREE.ShadeLoader] Loaded.' )

      console.log( ( window.material = material ) );

      const mesh = new THREE.Mesh( new THREE.TorusKnotBufferGeometry( null, null, 128, 16 ), material );

      scene.add( mesh );

      camera.lookAt( mesh.position );

      renderer.render( scene, camera );
    
      renderer.setAnimationLoop( (  ) => {

        mesh.rotation.y += 0.1 * clock.getDelta();

        renderer.render( scene, camera );

      } );

      // debug
      Object.assign( window, { camera, scene, renderer, material, mesh } );

    },

    () => console.info( '[THREE.ShadeLoader] Progress.' ),

    ( e ) => console.error( e )

  );
</script>
